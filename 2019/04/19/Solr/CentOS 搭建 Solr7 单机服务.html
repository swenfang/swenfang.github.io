<hr>
<p>tags:</p>
<pre><code>- Solr
</code></pre><p>categories: Solr</p>
<h2 id="title-CentOS-搭建-Solr7-单机服务"><a href="#title-CentOS-搭建-Solr7-单机服务" class="headerlink" title="title:CentOS 搭建 Solr7 单机服务"></a>title:CentOS 搭建 Solr7 单机服务</h2><h1 id="CentOS-搭建-Solr7-单机服务"><a href="#CentOS-搭建-Solr7-单机服务" class="headerlink" title="CentOS 搭建 Solr7 单机服务"></a>CentOS 搭建 Solr7 单机服务</h1><h2 id="一-Solr安装环境"><a href="#一-Solr安装环境" class="headerlink" title="一.Solr安装环境"></a>一.Solr安装环境</h2><h3 id="1-官方参考文档"><a href="#1-官方参考文档" class="headerlink" title="1.官方参考文档"></a>1.官方参考文档</h3><p>Solr教程参考指南：<a href="http://lucene.apache.org/solr/guide/7_4/solr-tutorial.html">http://lucene.apache.org/solr/guide/7_4/solr-tutorial.html</a></p>
<!--more-->
<h3 id="2-Solr运行环境"><a href="#2-Solr运行环境" class="headerlink" title="2.Solr运行环境"></a>2.Solr运行环境</h3><p>系统要求：Java 8+      这里我们把solr服务部署到Tomacat服务器中，Tomcat安装过程参考：<a href="https://www.cnblogs.com/frankdeng/p/9597699.html">https://www.cnblogs.com/frankdeng/p/9597699.html</a></p>
<p><strong>在solr5以前solr的启动都有tomcat作为容器，但是从solr5以后solr内部集成jetty服务器，可以通过bin目录中脚本直接启动。就是从solr5以后跟solr4最大的区别是被发布成一个独立的应用。</strong></p>
<h3 id="3-Solr下载"><a href="#3-Solr下载" class="headerlink" title="3.Solr下载"></a>3.Solr下载</h3><p> 下载地址：<a href="http://archive.apache.org/dist/lucene/solr/">http://archive.apache.org/dist/lucene/solr/</a></p>
<p><img src="http://blogimg.nos-eastchina1.126.net/shenwf20190419093633-377825.jpg" alt=""></p>
<pre><code>[admin@node21 software]$ wget http://archive.apache.org/dist/lucene/solr/7.4.0/solr-7.4.0.tgz
[admin@node21 software]$ ll
-rw-rw-r-- 1 admin admin 167346886 Jun 19 02:51 solr-7.4.0.tgz
</code></pre><h2 id="二-Solr单机安装"><a href="#二-Solr单机安装" class="headerlink" title="二.Solr单机安装"></a>二.Solr单机安装</h2><h3 id="1-解压安装包"><a href="#1-解压安装包" class="headerlink" title="1. 解压安装包"></a>1. 解压安装包</h3><pre><code>[admin@node21 software]$ tar zxvf solr-7.4.0.tgz 
[admin@node21 software]$ ls solr-7.4.0
bin CHANGES.txt contrib dist docs example licenses LICENSE.txt LUCENE_CHANGES.txt NOTICE.txt README.txt server
</code></pre><h3 id="2-部署solr到tomcat下"><a href="#2-部署solr到tomcat下" class="headerlink" title="2.部署solr到tomcat下"></a>2.部署solr到tomcat下</h3><p>注意，这里因为我用的是solr7.4最新版，所以跟solr4版本要拷贝*.war文件，然后再启动tomcat解压的操作是不一样的 ，</p>
<p><strong>1）复制并重命名solr目录里的server/solr-webapp/webapp文件夹到/usr/local/tomcat8/webapps/solr</strong></p>
<pre><code>[admin@node21 software]$ sudo cp -r solr-7.4.0/server/solr-webapp/webapp /usr/local/tomcat8/webapps/solr
</code></pre><p><img src="http://blogimg.nos-eastchina1.126.net/shenwf20190419093852-618647.jpg" alt=""></p>
<p><strong>2）拷贝solr-7.4.0\server\lib\ext 下的jar包以及lib目录下gmetric4j-1.0.7.jar和metrics开头的jar包拷贝到 tomcat8\webapps\solr 项目的WEB-INF\lib下</strong></p>
<pre><code>[admin@node21 software]$ sudo cp solr-7.4.0/server/lib/ext/* /usr/local/tomcat8/webapps/solr/WEB-INF/lib/
[admin@node21 software]$ sudo cp solr-7.4.0/server/lib/gmetric4j-1.0.7.jar /usr/local/tomcat8/webapps/solr/WEB-INF/lib/
[admin@node21 software]$ sudo cp solr-7.4.0/server/lib/metrics-*  /usr/local/tomcat8/webapps/solr/WEB-INF/lib/
</code></pre><p><img src="http://blogimg.nos-eastchina1.126.net/shenwf20190419093937-207098.jpg" alt=""></p>
<p><img src="http://blogimg.nos-eastchina1.126.net/shenwf20190419093955-399271.jpg" alt=""></p>
<p>3）<strong>创建一个索引库solrhome</strong></p>
<p>拷贝solr-7.4.0\server 下的solr文件夹到其它非中文目录下，重命名为solrhome，我是建立到了/usr/local/tomcat8/solrhome下</p>
<pre><code>[admin@node21 software]$ sudo cp -r solr-7.4.0/server/solr /usr/local/tomcat8/solrhome
</code></pre><p><img src="http://blogimg.nos-eastchina1.126.net/shenwf20190419094030-250401.jpg" alt=""></p>
<p>4）<strong>关联solr及索引库solrhome，</strong>需要修改tomcat里solr工程的web.xml文件</p>
<pre><code>[admin@node21 software]$ sudo vi /usr/local/tomcat8/webapps/solr/WEB-INF/web.xml 
</code></pre><p>找到如下代码，打开注释，修改自己的solrhome的路径/put/your/solr/home/here，我的是 /usr/local/tomcat8/solrhome 路径。</p>
<pre><code class="xml"><span class="comment">&lt;!--
  &lt;env-entry&gt;
     &lt;env-entry-name&gt;solr/home&lt;/env-entry-name&gt;
     &lt;env-entry-value&gt;/put/your/solr/home/here&lt;/env-entry-value&gt;
     &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;
  &lt;/env-entry&gt;
 --&gt;</span>
</code></pre>
<p>如下图：</p>
<p><img src="http://blogimg.nos-eastchina1.126.net/shenwf20190419094153-478365.jpg" alt=""></p>
<p>然后到最下方，将这一段注释掉，不然会报403错误，完成后保存退出（solr4部署不用注释这个）</p>
<p><img src="http://blogimg.nos-eastchina1.126.net/shenwf20190419094222-739442.jpg" alt=""></p>
<p><strong>5）拷贝solr7.4.0\server\resources下的</strong> log4j2.xml <strong>到tomcat8/webapps/solr/WEB-INF\classes，如果WEB-INF下没有classes文件那么就创建一个classes文件夹</strong> </p>
<pre><code>[admin@node21 tomcat8]$ sudo mkdir -p /usr/local/tomcat8/webapps/solr/WEB-INF/classes/
[admin@node21 tomcat8]$ sudo cp -r /opt/software/solr-7.4.0/server/resources/log4j2.xml /usr/local/tomcat8/webapps/solr/WEB-INF/classes/
</code></pre><p><strong>6）修改tomcat的bin目录下catalina.bat脚本，增加solr.log.dir系统变量，指定solr日志记录存放地址。</strong></p>
<pre><code>[root@node21 solr]# vi /usr/local/tomcat8/bin/catalina.sh 
JAVA_OPTS=&quot;$JAVA_OPTS -Dsolr.log.dir=/usr/local/tomcat8/solrhome/logs&quot;
</code></pre><p><img src="http://blogimg.nos-eastchina1.126.net/shenwf20190419094314-214585.jpg" alt=""></p>
<h3 id="3-启动服务"><a href="#3-启动服务" class="headerlink" title="3.启动服务"></a>3.启动服务</h3><p>启动tomcat，访问需要完整路径，我的是 <a href="http://47.106.180.186:8089/solr/index.html">http://47.106.180.186:8089/solr/index.html</a></p>
<p><img src="http://blogimg.nos-eastchina1.126.net/shenwf20190419094507-951150.jpg" alt=""></p>
